---
sidebar_position: 1
---

# The SLV Custom Resource (CRD)

## What is the SLV CRD?
When SLV is run locally, the vault is simply a file stored on the local filesystem. However, when running in Kubernetes, this model translates into a Kubernetes-native approach. Instead of being saved as a local file, the vault is stored as a **custom resource** called `SLV` within the Kubernetes API server, backed by the cluster's `etcd` database.

The definition for the `SLV` custom resource can be found [here](https://github.com/amagioss/slv/blob/main/internal/k8s/config/crd/bases/slv.sh_slvs.yaml).

---

## Structure of the Custom Resource
You will typically **not** need to manually create an `SLV` resource; the SLV binary handles this automatically. However, for understanding purposes, a typical `SLV` custom resource looks like this:

```yaml
# This file is managed by SLV. DO NOT EDIT THIS FILE MANUALLY.
apiVersion: slv.sh/v1
kind: SLV
metadata:
  name: vault
  namespace: slv
spec:
  slvConfig:
    id: SLV_VID_...
    publicKey: SLV_VPK_...
    wrappedKeys:
      - SLV_EWK_...
  slvData:
    key1: SLV_VSS_...
    key2: SLV_VSS_...
```

The structure mirrors the local file-based vault, ensuring consistency between local and Kubernetes deployments.

Starting with version `0.9.0`, SLV maintains a **unified vault structure** across all environments. Older vault formats remain compatible and are automatically migrated upon updates.

---

## Reconciling Secrets from the Vault

Since the vault stores **encrypted data**, applications cannot consume it directly. To make secrets consumable, the `SLV` resources must be **reconciled into Kubernetes Secrets**.

> **Note:** Before reconciliation, ensure that the environment secret key or binding is loaded into the cluster. More details on loading secrets will be provided later.

### Modes of Reconciliation

> **Note:** reconcilation happens only within a namespace and is one-to-one. i.e, If you create an SLV object in a namespace, the corresponding secret would be created in the same namespace with the same name as the object.


There are three supported ways to reconcile SLV vault objects into Kubernetes Secrets:

#### 1. Operator (Recommended)
- Runs continuously as a **Kubernetes Deployment**.
- **Watches** SLV custom resources and **immediately reconciles** any changes.
- Ideal for environments requiring real-time updates and automation.

#### 2. Job (One-Off Reconciliation)
- Reconciles SLV objects **once and exits**.
- Best suited for clusters where running a continuous operator is impractical.
- Good for manual, controlled reconciliation workflows.

#### 3. CronJob (Scheduled Reconciliation)
- Periodically reconciles SLV objects on a **defined schedule**.
- Useful when delayed synchronization is acceptable, and immediate consistency is not critical.



